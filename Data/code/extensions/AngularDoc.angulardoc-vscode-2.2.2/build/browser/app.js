"use strict";function Map(){this.keys=new Array,this.data=new Object,this.put=function(e,t){return null==this.data[e]?(this.keys.push(e),this.data[e]=t):this.data[e]=this.data[e],!0},this.get=function(e){return this.data[e]},this.remove=function(e){for(var t=0;t<this.keys.length;t++)if(e===this.keys[t]){var n=this.keys.splice(t,1);for(k in n)this.data[k]=null;return!0}return!1},this.each=function(e){if("function"==typeof e)for(var t=this.keys.length,n=0;n<t;n++){var o=this.keys[n];e(o,this.data[o],n)}},this.entrySet=function(){for(var e=this.keys.length,t=new Array(e),n=0;n<e;n++)t[n]={key:this.keys[n],value:this.data[this.keys[n]]};return t},this.isEmpty=function(){return 0==this.keys.length},this.size=function(){return this.keys.length},this.containsKey=function(e){return this.keys.filter(function(t){if(t===e)return e}).length>0},this.toString=function(){for(var e="{",t=0;t<this.keys.length;t++){var n=this.keys[t];e+=n+"="+this.data[n],this.keys.length>t+1&&(e+=",")}return e+="}"},this.parserStringAndAddMap=function(e){var t=0;if(e&&e.length>0){e=e.trim();var n=e.indexOf("{"),o=e.lastIndexOf("}");if(n!==-1&&o!==-1){e=e.substring(n+1,o);for(var a=e.split(","),i=0;i<a.length;i++){var r=a[i].trim();if(r.length>0&&r.indexOf("=")!==-1){var s=r.split("=");2==s.length&&(this.put(s[0].trim(),s[1].trim())?t++:console.error("error: kv:"+r))}}}else console.log("data error:"+e)}else console.log("data is not empty");return t}}angular.module("AngularDoc-VsCode",["ngAnimate","ngCookies","ngResource","ngRoute","ui.router","ngSanitize","ngTouch","ngMaterial","ngMessages","angular-jwt","ngWebSocket"]),angular.module("AngularDoc-VsCode").controller("loginCtrl",["$scope","$timeout","$mdSidenav","$log","$http","$filter","$mdDialog","Messages",function(e,t,n,o,a,i,r,s){localStorage.removeItem("angulardoc_select_view_name"),e.singin=function(t,n){if(t){var o={email:$("#username").val(),password:$("#password").val()},a=$("#signInUrl").val();$.ajax({url:a,type:"POST",data:o,async:!1,success:function(t){var o={email:$("#username").val(),token:t.token},a=encodeURI("command:ngdoc.signIn?"+JSON.stringify(o));$("#signin").attr("href",a),document.getElementById("signin").click(),e.$parent.updateTheSwith("true",t.token,$("#username").val(),n)},error:function(e){console.log(JSON.stringify(e));var t=encodeURI("command:ngdoc.loginError?"+JSON.stringify(e.responseText));$("#signin").attr("href",t),document.getElementById("signin").click()}})}},e.userFlag="false"!=$("#userFlag").val();var l=localStorage.getItem("angulardoc_userFlag");l&&(e.userFlag="false"!=l),e.signInContent=e.userFlag,e.signUpContent=!e.userFlag,e.switchToSignUp=function(){e.signInContent=e.signUpContent,e.signUpContent=!e.signUpContent},e.switchToSignIn=function(){e.signInContent=!e.signInContent,e.signUpContent=!e.signUpContent},e.singup=function(t,n){if(t){var o={email:$("#c_username").val(),password:$("#c_password").val(),loginName:$("#c_username").val(),provider:"vscode"},a=$("#signUpUrl").val();$.ajax({url:a,type:"POST",data:o,async:!1,success:function(t){var o={email:$("#c_username").val(),password:$("#c_password").val(),token:t.token},a=encodeURI("command:ngdoc.signUp?"+JSON.stringify(o));$("#signup").attr("href",a),document.getElementById("signup").click(),e.$parent.updateTheSwith("true",t.token,$("#c_username").val(),n)},error:function(e){var t=encodeURI("command:ngdoc.loginError?"+JSON.stringify(e.responseText));$("#signup").attr("href",t),document.getElementById("signup").click()}})}}}]).controller("MainCtrl",["$scope","$timeout","$mdSidenav","$log","$http","jwtHelper","$mdDialog","Messages","StripJsonComments","$websocket","$window",function(e,t,n,o,a,i,r,s,l,c,u){function g(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e)}}e.Messages=s,e.$watch(function(){return s},function(e,t){console.log("newV Messages"),e&&console.log(JSON.stringify(e))}),e.swithToDashBoardView="false",e.isNeedNpmInstall=$("#isNeedNpmInstall").val();var d=$("#swithToDashBoardView").val(),f=localStorage.getItem("angulardoc_token"),h=localStorage.getItem("angulardoc_userName"),m=function(e){localStorage.setItem("angulardoc_token",e),$.each($(".diagramUrl"),function(t,n){var o=$(n).val();console.log(o.split("?").length),o.split("?").length>1?$(n).val(o.split("?")[0]+"?access_token="+e):$(n).val(o+"?access_token="+e)})};if(h)if(f){var p=i.getTokenExpirationDate(f),v=new Date,y=moment(v).isBefore(p);y?(m(f),d="true"):d="false"}else d="false";else d="false";e.swithToDashBoardView=d;e.loginSuccess=!1;var w=$("#wsUrl").val();e.updateTheSwith=function(t,n,o,a){localStorage.setItem("angulardoc_userFlag","true"),localStorage.setItem("angulardoc_token",n),localStorage.setItem("angulardoc_userName",o),$.each($(".diagramUrl"),function(e,t){$.each($(".diagramUrl"),function(e,t){var o=$(t).val();console.log(o.split("?").length),o.split("?").length>1?$(t).val(o.split("?")[0]+"?access_token="+n):$(t).val(o+"?access_token="+n)})}),e.loginSuccess=t,e.showLoadingPage(a);var i=c(w);i.onMessage(function(t){var n;try{n=JSON.parse(event.data)}catch(e){n={username:"anonymous",message:event.data}}console.log("refresh",n),n.refresh&&e.getLastSync()})},e.swithToLogin=function(t){e.showSignoutPage(t)},e.signout=function(t){var n=encodeURI("command:ngdoc.logout");$("#signout").attr("href",n),document.getElementById("signout").click(),localStorage.removeItem("angulardoc_token"),localStorage.removeItem("angulardoc_userName"),e.closeSignOutDialog(),e.swithToDashBoardView="false"},e.closeSignOutDialog=function(){r.hide()},e.showSignoutPage=function(e){r.show({controller:g,contentElement:"#signoutDialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})},e.showLoadingPage=function(e){r.show({controller:g,contentElement:"#loadingPageContent",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1})};$("#repoSettingsPath").val();e.getLastSync=function(){e.swithToDashBoardView=e.loginSuccess,r.hide()}}]).controller("DashboardCtrl",["$scope","$timeout","$mdSidenav","$log","$http",function(e,t,n,o,a){function i(n,o,a){var i;return function(){var a=e,r=Array.prototype.slice.call(arguments);t.cancel(i),i=t(function(){i=void 0,n.apply(a,r)},o||10)}}function r(e){return i(function(){n(e).toggle().then(function(){o.debug("toggle "+e+" is done")})},200)}function s(e){return function(){n(e).toggle().then(function(){o.debug("toggle "+e+" is done")})}}e.views=[{type:"overview",icon:"sitemap"},{type:"classes",icon:"code"},{type:"modules",icon:"th-large"},{type:"routers",icon:"random"},{type:"imports",icon:"compress"}],e.selectedView=localStorage.getItem("angulardoc_select_view_name")||"overview",localStorage.setItem("angulardoc_select_view_name",e.selectedView),e.architectureUrl=$("#architectureUrl").attr("value"),e.classesDataUrl=$("#classesDataUrl").attr("value"),e.importsDataUrl=$("#importsDataUrl").attr("value"),e.modulesDataUrl=$("#modulesDataUrl").attr("value"),e.routersDataUrl=$("#routersDataUrl").attr("value"),e.selectView=function(t){localStorage.setItem("angulardoc_select_view_name",t),e.selectedView=t,$("#selectView").attr("href",encodeURI("command:ngdoc.selectDashboardView?"+JSON.stringify(t)));var n=document.getElementById("selectView");n.click(),$("#selectView").attr("href","")},e.toggleLeft=r("left"),e.toggleRight=s("right"),e.isOpenRight=function(){return n("right").isOpen()},e.showSignOut=function(t){e.$parent.swithToLogin(t)}}]).controller("LeftCtrl",["$scope","$timeout","$mdSidenav","$log",function(e,t,n,o){e.close=function(){n("left").close().then(function(){o.debug("close LEFT is done")})}}]).controller("RightCtrl",["$scope","$timeout","$mdSidenav","$log",function(e,t,n,o){e.close=function(){n("right").close().then(function(){o.debug("close RIGHT is done")})}}]).factory("diagramServer",["$rootScope",function(e){var t=function(e,t){var n=document.getElementById("__getwidth");return null==n&&(n=document.createElement("span"),n.id=e+"-offsetWidth",document.body.appendChild(n),n.style.visibility="hidden",n.style.whiteSpace="nowrap"),n.innerHTML=e,n.style.fontSize=t+"px",n.offsetWidth};return{getTextWidth:t}}]).directive("compareTo",[function(){return{restrict:"A",require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,n,o){o.$validators.compareTo=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){o.$validate()})}}}]).factory("Messages",["$websocket",function(e){var t=$("#wsUrl").val(),n=e(t),o=[],a={};return n.onMessage(function(e){var t;try{t=JSON.parse(e.data)}catch(n){t={username:"anonymous",message:e.data}}a=t,a.repoId&&(console.log("architectureUrl"),$.each($(".diagramUrl"),function(e,t){var n=$(t).val().split("/"),o=n[0];n.splice(0,2),n.splice(4,1,a.repoId),n=n.join("/");var i=o+"//"+n;console.log(i),$(t).val(i)}))}),n.onError(function(e){console.log("connection Error",e)}),n.onClose(function(e){console.log("connection closed",e)}),n.onOpen(function(){console.log("connection open")}),{data:a,collection:o,status:function(){return n.readyState},send:function(e){angular.isString(e)?n.send(e):angular.isObject(e)&&n.send(JSON.stringify(e))}}}]).factory("StripJsonComments",["$websocket",function(e){var t=1,n=2,o=function(){return""},a=function(e,t,n){return e.slice(t,n).replace(/\S/g," ")},i=function(e,i){i=i||{};for(var r,s,l=!1,c=!1,u=0,g="",d=i.whitespace===!1?o:a,f=0;f<e.length;f++){if(r=e[f],s=e[f+1],!c&&'"'===r){var h="\\"===e[f-1]&&"\\"!==e[f-2];h||(l=!l)}if(!l)if(c||r+s!=="//"){if(c===t&&r+s==="\r\n"){f++,c=!1,g+=d(e,u,f),u=f;continue}if(c===t&&"\n"===r)c=!1,g+=d(e,u,f),u=f;else{if(!c&&r+s==="/*"){g+=e.slice(u,f),u=f,c=n,f++;continue}if(c===n&&r+s==="*/"){f++,c=!1,g+=d(e,u,f+1),u=f+1;continue}}}else g+=e.slice(u,f),u=f,c=t,f++}return g+(c?d(e.substr(u)):e.substr(u))};return{stripJsonComments:i}}]);